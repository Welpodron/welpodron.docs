"use strict";(()=>{class i{static#SUPPORTED_ACTIONS=["toggle","show","close"];element;pinned;hoverable;hoverableLeaveTimeout=null;lastAnchor=null;outsideControls;insideControls;dialogAttrObserver;constructor({element:e,config:t={}}){this.element=e,this.pinned=t.pinned??null!=this.element.getAttribute("data-popover-pinned"),this.hoverable=t.hoverable??null!=this.element.getAttribute("data-popover-hoverable"),this.outsideControls=[...document.querySelectorAll(`[data-popover-action][data-popover-id="${this.element.id}"]:not(#${this.element.id} *)`)],this.insideControls=[...this.element.querySelectorAll(`[data-popover-action][data-popover-id="${this.element.id}"]`)],this.dialogAttrObserver=new MutationObserver((e,t)=>{e.forEach(async e=>{"open"===e.attributeName&&e.target.hasAttribute("open")&&(this.hoverable&&(this.element.removeEventListener("mouseenter",this.#handleElementMouseEnter),this.element.addEventListener("mouseenter",this.#handleElementMouseEnter),this.element.removeEventListener("mouseleave",this.#handleElementMouseLeave),this.element.addEventListener("mouseleave",this.#handleElementMouseLeave)),this.insideControls.forEach(e=>{e.removeEventListener("click",this.#handleControlClick),e.addEventListener("click",this.#handleControlClick)}),document.removeEventListener("click",this.#handleDocumentClick),document.addEventListener("click",this.#handleDocumentClick),document.removeEventListener("keydown",this.#handleDocumentKeydown),document.addEventListener("keydown",this.#handleDocumentKeydown),window.removeEventListener("resize",this.#handleWindowResize),window.addEventListener("resize",this.#handleWindowResize))})}),this.dialogAttrObserver.observe(this.element,{attributes:!0}),this.element.hasAttribute("open")&&(document.removeEventListener("click",this.#handleDocumentClick),document.addEventListener("click",this.#handleDocumentClick),document.removeEventListener("keydown",this.#handleDocumentKeydown),document.addEventListener("keydown",this.#handleDocumentKeydown),window.removeEventListener("resize",this.#handleWindowResize),window.addEventListener("resize",this.#handleWindowResize),this.hoverable&&(this.element.removeEventListener("mouseleave",this.#handleElementMouseLeave),this.element.addEventListener("mouseleave",this.#handleElementMouseLeave)),this.lastAnchor=this.outsideControls[0],this.#calculatePosition({anchor:this.lastAnchor})),this.element.removeEventListener("close",this.#handleElementClose),this.element.addEventListener("close",this.#handleElementClose),this.outsideControls.forEach(e=>{e.removeEventListener("click",this.#handleControlClick),e.addEventListener("click",this.#handleControlClick),this.hoverable&&(e.removeEventListener("mouseenter",this.#handleControlMouseEnter),e.removeEventListener("mouseleave",this.#handleControlMouseLeave),e.addEventListener("mouseenter",this.#handleControlMouseEnter),e.addEventListener("mouseleave",this.#handleControlMouseLeave))})}#handleControlMouseEnter=e=>{null!=this.hoverableLeaveTimeout&&clearTimeout(this.hoverableLeaveTimeout),this.element.hasAttribute("open")||this.show({evt:e})};#handleControlMouseLeave=e=>{null!=this.hoverableLeaveTimeout&&clearTimeout(this.hoverableLeaveTimeout),this.hoverableLeaveTimeout=setTimeout(()=>{this.element.contains(document.activeElement)||this.element.hasAttribute("open")&&this.close()},100)};#handleElementMouseEnter=e=>{null!=this.hoverableLeaveTimeout&&clearTimeout(this.hoverableLeaveTimeout)};#handleElementMouseLeave=e=>{null!=this.hoverableLeaveTimeout&&clearTimeout(this.hoverableLeaveTimeout),this.hoverableLeaveTimeout=setTimeout(()=>{this.element.contains(document.activeElement)||this.element.hasAttribute("open")&&this.close()},100)};toggle=({evt:e})=>this.element.hasAttribute("open")?this.close():this.show({evt:e});close=()=>{this.element.close("dismiss")};show=({evt:t})=>{var e=this.outsideControls.find(e=>e.contains(t.target));e&&(this.lastAnchor=e,this.element.style.visibility="hidden",this.element.show(),this.#calculatePosition({anchor:e}),this.element.style.visibility="visible")};#calculatePosition=({anchor:e})=>{var t,n,i,{width:e,height:o}=e.getBoundingClientRect();this.element.style.left="0px",this.element.style.top=0+o+"px",this.pinned||({width:o,height:t,left:n,top:i}=this.element.getBoundingClientRect(),Math.ceil(o+o)>=document.documentElement.clientWidth&&(this.element.style.left=0-o+e+"px"),Math.ceil(i+t)>=document.documentElement.clientHeight&&(this.element.style.top=0-t+"px"))};#handleControlClick=e=>{var t=e["currentTarget"],n=t.getAttribute("data-popover-action"),t=t.getAttribute("data-popover-action-args");return i.#SUPPORTED_ACTIONS.includes(n)&&(n=this[n])instanceof Function?n({args:t,evt:e}):void 0};#handleDocumentClick=({target:t})=>{this.outsideControls.some(e=>e.contains(t))||this.element.contains(t)||this.close()};#handleDocumentKeydown=({key:e})=>{"Escape"===e&&this.close()};#handleElementClose=({})=>{this.hoverable&&(this.element.removeEventListener("mouseenter",this.#handleElementMouseEnter),this.element.removeEventListener("mouseleave",this.#handleElementMouseLeave)),window.removeEventListener("resize",this.#handleWindowResize),document.removeEventListener("click",this.#handleDocumentClick),document.removeEventListener("keydown",this.#handleDocumentKeydown),this.insideControls.forEach(e=>{e.removeEventListener("click",this.#handleControlClick)})};#handleWindowResize=()=>{this.lastAnchor&&this.#calculatePosition({anchor:this.lastAnchor})}}null==window.welpodron&&(window.welpodron={}),window.welpodron.popover=i,document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("dialog[data-popover]").forEach(e=>{new i({element:e})})},{once:!0})})();
//# sourceMappingURL=script.min.js.map